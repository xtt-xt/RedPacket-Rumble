<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>红包派对 · 侧边栏版</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
</head>
<body>
    <!-- 主聊天界面 -->
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-left">
                <span class="menu-toggle" id="menuToggle">☰</span>
                <span>🧧 红包派对</span>
            </div>
            <div class="header-actions">
                <span class="status-badge" id="activeStatus">🔥活跃</span>
                <span class="balance-area" id="balanceDisplay">100.00</span>
            </div>
        </div>
        <div class="message-area" id="messageArea"></div>
        <div class="input-area">
            <button class="redpacket-btn" id="showRedpacketModal">发红包</button>
            <textarea id="chatInput" placeholder="说句话..." maxlength="200" rows="1"></textarea>
            <button id="sendMsgBtn">发送</button>
        </div>
    </div>

    <!-- 侧边栏 -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">红包派对</div>
        <div class="sidebar-menu">
            <div class="menu-item" id="sidebarUpload">📤 上传</div>
            <div class="menu-item" id="sidebarDownload">📥 下载</div>
            <div class="menu-item" id="sidebarPasteImport">📋 导入</div>
            <div class="menu-item" id="sidebarCopyExport">📎 导出</div>
            <div class="menu-item" id="sidebarClear">🗑️ 清除数据</div>
            <div class="menu-item" id="sidebarLink">🔗 跳转链接</div>
            <div class="menu-item" id="sidebarChangelog">📜 更新日志</div>
        </div>
        <div class="sidebar-version" id="sidebarVersionDisplay">加载中...</div>
        <div class="sidebar-footer">作者xtt</div>
    </div>

    <!-- 隐藏的文件导入输入框 -->
    <input type="file" id="importFile" accept=".txt,.json" style="display: none;">

    <!-- 发红包弹窗 -->
    <div class="modal" id="redpacketModal">
        <div class="modal-card">
            <h3>发红包 🧧</h3>
            <label>金额 (元)</label>
            <input type="number" id="rpAmount" min="0.01" step="0.01" value="2.00">
            <label>个数 (1-6)</label>
            <input type="number" id="rpCount" min="1" max="6" value="3">
            <label>祝福语</label>
            <textarea id="rpBlessing" maxlength="30" placeholder="恭喜发财，大吉大利" rows="2">恭喜发财，大吉大利</textarea>
            <div class="modal-actions">
                <button class="btn-secondary" id="cancelRedpacket">取消</button>
                <button class="btn-primary" id="confirmRedpacket">塞钱进红包</button>
            </div>
        </div>
    </div>

    <!-- 导出选项模态框 -->
    <div class="modal" id="exportOptionsModal">
        <div class="modal-card">
            <h3>⬇️ 导出存档选项</h3>
            <div class="export-option-item">
                <label>保留最近 <input type="number" id="exportMsgCount" min="0" value="50" placeholder="全部"> 条消息</label>
                <span style="font-size:12px; color:#999;">(0表示全部)</span>
            </div>
            <div class="export-option-item">
                <label style="justify-content: space-between; width:100%;">
                    <span>保存红包领取详情</span>
                    <input type="checkbox" id="exportKeepDetails" checked>
                </label>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="cancelExport">取消</button>
                <button class="btn-primary" id="confirmExport">确认导出</button>
            </div>
        </div>
    </div>

    <!-- 粘贴导入模态框 -->
    <div class="modal" id="pasteImportModal">
        <div class="modal-card">
            <h3>📋 粘贴加密存档</h3>
            <textarea id="pasteArchiveText" rows="6" placeholder="请将加密文本粘贴到这里..." style="width:100%; padding:12px; border-radius:16px; border:1px solid #ddd; margin:16px 0; resize:vertical;"></textarea>
            <div class="modal-actions">
                <button class="btn-secondary" id="cancelPaste">取消</button>
                <button class="btn-primary" id="confirmPaste">确认导入</button>
            </div>
        </div>
    </div>

    <!-- 更新日志模态框（支持多版本） -->
    <div class="modal" id="changelogModal">
        <div class="modal-card" style="width:350px; max-height:80vh; overflow-y:auto;">
            <h3 id="changelogModalTitle">📜 更新日志</h3>
            <div id="changelogContent" style="white-space: pre-wrap; font-size:14px; margin:16px 0;">加载中...</div>
            <div class="modal-actions" id="changelogActions">
                <button class="btn-secondary" id="closeChangelogBtn">关闭</button>
            </div>
        </div>
    </div>

    <!-- 开红包/结果全屏模态 -->
    <div class="modal" id="openResultModal">
        <div id="dynamicRedpacketContent" style="width:100%; height:100%; display: flex; align-items: center; justify-content: center;"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>
